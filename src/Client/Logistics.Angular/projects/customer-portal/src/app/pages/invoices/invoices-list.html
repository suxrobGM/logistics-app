<div class="mb-6 flex items-center justify-between">
  <h1 class="text-2xl font-bold text-gray-900">My Invoices</h1>
  <p-iconfield>
    <p-inputicon class="pi pi-search" />
    <input
      type="text"
      pInputText
      placeholder="Search invoices..."
      class="w-64"
      (input)="onSearch($any($event.target).value)"
    />
  </p-iconfield>
</div>

<div class="rounded-lg bg-white shadow">
  <p-table
    [value]="invoices()"
    [lazy]="true"
    [paginator]="true"
    [rows]="10"
    [first]="tableFirst()"
    [totalRecords]="totalRecords()"
    [loading]="isLoading()"
    [rowsPerPageOptions]="[10, 25, 50]"
    [tableStyle]="{ 'min-width': '50rem' }"
    (onLazyLoad)="onLazyLoad($event)"
  >
    <ng-template #header>
      <tr>
        <th>Invoice #</th>
        <th>Load</th>
        <th>Date</th>
        <th>Due Date</th>
        <th>Amount</th>
        <th>Status</th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template #body let-invoice>
      <tr>
        <td class="font-medium">INV-{{ invoice.number }}</td>
        <td>
          @if (invoice.loadId) {
            <a [routerLink]="['/shipments', invoice.loadId]" class="text-primary hover:underline">
              #{{ invoice.loadNumber }}
            </a>
          } @else {
            -
          }
        </td>
        <td>{{ invoice.createdAt | dateFormat: "mediumDate" }}</td>
        <td>{{ invoice.dueDate | dateFormat: "mediumDate" }}</td>
        <td class="font-medium">{{ invoice.total | currencyFormat }}</td>
        <td>
          <p-tag [value]="invoice.status" [severity]="getStatusSeverity(invoice.status)" />
        </td>
        <td class="text-right">
          <p-button
            icon="pi pi-download"
            [text]="true"
            label="Download"
            (click)="downloadInvoice(invoice)"
          />
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="7" class="py-12 text-center">
          <i class="pi pi-inbox mb-2 text-4xl text-gray-300"></i>
          <p class="text-gray-500">No invoices found</p>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-toast />
