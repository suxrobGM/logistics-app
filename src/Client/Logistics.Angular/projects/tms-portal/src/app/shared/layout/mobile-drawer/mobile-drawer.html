<p-drawer
  [visible]="visible()"
  (visibleChange)="onVisibleChange($event)"
  position="left"
  [modal]="true"
  [closeOnEscape]="true"
  [dismissible]="true"
  [showCloseIcon]="true"
  styleClass="mobile-nav-drawer"
>
  <ng-template #header>
    <div class="mobile-nav-header">
      @if (companyLogoUrl()) {
        <img [src]="companyLogoUrl()" class="mobile-nav-logo" alt="Company logo" />
      } @else {
        <img src="images/logo.svg" class="mobile-nav-logo" alt="Logo" />
      }
      @if (companyName()) {
        <h4 class="mobile-nav-company">{{ companyName() }}</h4>
      }
    </div>
  </ng-template>

  <nav class="mobile-nav-menu flex h-full flex-col">
    <!-- Navigation Items -->
    <div class="flex-1 overflow-y-auto py-3">
      @for (item of navItems(); track item.label) {
        @if (item.items && item.items.length > 0) {
          <!-- Expandable Menu Item -->
          <div class="mb-0.5">
            <button
              class="mobile-nav-item"
              [attr.aria-expanded]="item.expanded"
              (click)="toggleExpanded(item)"
            >
              <div class="flex items-center gap-3.5">
                <i [class]="item.icon"></i>
                <span>{{ item.label }}</span>
              </div>
              <i class="mobile-nav-chevron pi pi-chevron-down" [class.expanded]="item.expanded"></i>
            </button>

            @if (item.expanded) {
              <div class="mobile-nav-submenu mt-0.5 space-y-0.5">
                @for (subItem of item.items; track subItem.label) {
                  @if (subItem.isSeparator) {
                    <div class="mobile-nav-separator">
                      <div class="mobile-nav-separator-line"></div>
                      <span class="mobile-nav-separator-label">{{ subItem.label }}</span>
                    </div>
                  } @else {
                    <button class="mobile-nav-subitem" (click)="navigateTo(subItem.route!)">
                      {{ subItem.label }}
                    </button>
                  }
                }
              </div>
            }
          </div>
        } @else {
          <!-- Direct Link Item -->
          <button class="mobile-nav-item" (click)="navigateTo(item.route!)">
            <div class="flex items-center gap-3.5">
              <i [class]="item.icon"></i>
              <span>{{ item.label }}</span>
            </div>
          </button>
        }
      }
    </div>

    <!-- User Section -->
    <div class="mobile-user-section">
      @if (userFullName()) {
        <div class="mobile-user-info">
          <div class="mobile-user-avatar">
            <i class="pi pi-user"></i>
          </div>
          <div>
            <p class="mobile-user-name">{{ userFullName() }}</p>
            @if (userRole()) {
              <p class="mobile-user-role">{{ userRole() }}</p>
            }
          </div>
        </div>
      }

      <button class="mobile-action-button" (click)="openAccountUrl()">
        <i class="pi pi-user-edit"></i>
        <span>Manage Profile</span>
      </button>

      <div class="mobile-theme-row">
        <div class="mobile-theme-label">
          <i class="pi pi-palette"></i>
          <span>Theme</span>
        </div>
        <app-theme-toggle [showLabel]="false" />
      </div>

      <button class="mobile-action-button mobile-logout-button" (click)="logout()">
        <i class="pi pi-sign-out"></i>
        <span>Sign Out</span>
      </button>
    </div>
  </nav>
</p-drawer>
