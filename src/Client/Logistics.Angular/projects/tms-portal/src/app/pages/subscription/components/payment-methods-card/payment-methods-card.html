<p-card header="Payment Methods">
  <div class="flex flex-col gap-3">
    @for (paymentMethod of paymentMethods(); track paymentMethod.id) {
      <p-card>
        <ng-template #title>
          <span>{{ getMethodLabel(paymentMethod) }}</span>
          @if (paymentMethod.isDefault) {
            <p-tag severity="success" value="Default" class="ml-2" />
          }
        </ng-template>

        <ng-template #subtitle>
          @switch (paymentMethod.verificationStatus) {
            @case ("verified") {
              <p-tag severity="success" value="Verified" />
            }
            @case ("unverified") {
              <p-tag severity="danger" value="Unverified" />
            }
            @case ("pending") {
              <p-tag severity="warn" value="Verification Pending" />
            }
          }
        </ng-template>

        <div class="mb-2 grid grid-cols-12">
          @switch (paymentMethod.type) {
            <!-- Card -->
            @case ("card") {
              <div class="col-span-6 font-bold">Cardholder Name:</div>
              <div class="col-span-6">{{ paymentMethod.cardHolderName }}</div>

              <div class="col-span-6 font-bold">Card Number:</div>
              <div class="col-span-6">{{ paymentMethod.cardNumber }}</div>

              <div class="col-span-6 font-bold">CVC:</div>
              <div class="col-span-6">{{ paymentMethod.cvc }}</div>

              <div class="col-span-6 font-bold">Expiry Date:</div>
              <div class="col-span-6">{{ paymentMethod.expMonth }}/{{ paymentMethod.expYear }}</div>
            }
            <!-- US Bank Account -->
            @case ("us_bank_account") {
              <div class="col-span-6 font-bold">Account Holder Type:</div>
              <div class="col-span-6">{{ paymentMethod.accountHolderType }}</div>

              <div class="col-span-6 font-bold">Account Holder:</div>
              <div class="col-span-6">{{ paymentMethod.accountHolderName }}</div>

              <div class="col-span-6 font-bold">Bank Name:</div>
              <div class="col-span-6">{{ paymentMethod.bankName }}</div>

              <div class="col-span-6 font-bold">Account Number:</div>
              <div class="col-span-6">{{ paymentMethod.accountNumber }}</div>

              <div class="col-span-6 font-bold">Routing Number:</div>
              <div class="col-span-6">{{ paymentMethod.routingNumber }}</div>

              <div class="col-span-6 font-bold">Account Type:</div>
              <div class="col-span-6">{{ paymentMethod.accountType }}</div>

              @if (
                paymentMethod.verificationStatus !== "verified" && paymentMethod.verificationUrl
              ) {
                <div class="col-span-6 font-bold">Verification URL:</div>
                <div class="col-span-6">
                  <a [href]="paymentMethod.verificationUrl" target="_blank">Click here to verify</a>
                </div>
              }
            }
            <!-- International Bank Account -->
            @case ("international_bank_account") {
              <div class="col-span-6 font-bold">Account Holder:</div>
              <div class="col-span-6">{{ paymentMethod.accountHolderName }}</div>

              <div class="col-span-6 font-bold">Bank Name:</div>
              <div class="col-span-6">{{ paymentMethod.bankName }}</div>

              <div class="col-span-6 font-bold">Account Number:</div>
              <div class="col-span-6">{{ paymentMethod.accountNumber }}</div>

              <div class="col-span-6 font-bold">SWIFT:</div>
              <div class="col-span-6">{{ paymentMethod.swiftCode }}</div>
            }
          }

          <div class="col-span-6 font-bold">Billing Address:</div>
          <div class="col-span-6">{{ paymentMethod.billingAddress | address }}</div>
        </div>

        <ng-template #footer>
          <div class="flex gap-2">
            @if (!paymentMethod.isDefault) {
              <p-button
                label="Set as Default"
                icon="pi pi-check"
                size="small"
                [disabled]="isLoading()"
                (click)="setDefaultPaymentMethod(paymentMethod)"
              />
            }

            <p-button
              label="Delete"
              icon="pi pi-times"
              severity="danger"
              size="small"
              [disabled]="isLoading()"
              (click)="deletePaymentMethod(paymentMethod)"
            />
          </div>
        </ng-template>
      </p-card>
    }
  </div>
  <p-button
    label="Add Payment Method"
    icon="pi pi-plus"
    size="small"
    [disabled]="isLoading()"
    (click)="showDialog.set(true)"
    styleClass="mt-3"
  />
</p-card>

<app-payment-method-dialog
  [(showDialog)]="showDialog"
  (paymentMethodAdded)="fetchPaymentMethods()"
/>
