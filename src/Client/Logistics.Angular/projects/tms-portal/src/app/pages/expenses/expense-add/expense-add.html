<p-toast />

<div class="mx-auto max-w-4xl">
  <div class="flex items-start justify-between">
    <ui-page-header title="Add Expense" [showAddButton]="false" />
    <p-button icon="pi pi-arrow-left" label="Back" [routerLink]="['/expenses']" [outlined]="true" />
  </div>

  <p-card>
    <p-tabs [value]="activeTab()" (valueChange)="onTabChange($event)">
      <p-tablist>
        <p-tab [value]="0">Company Expense</p-tab>
        <p-tab [value]="1">Truck Expense</p-tab>
        <p-tab [value]="2">Body Shop Expense</p-tab>
      </p-tablist>

      <p-tabpanels>
        <!-- Company Expense Form -->
        <p-tabpanel [value]="0">
          <form
            [formGroup]="companyForm"
            (ngSubmit)="submitCompanyExpense()"
            class="space-y-4 pt-4"
          >
            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Amount" for="company-amount" [required]="true">
                <p-inputNumber
                  id="company-amount"
                  formControlName="amount"
                  mode="currency"
                  currency="USD"
                  [min]="0"
                  styleClass="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Category" for="company-category" [required]="true">
                <p-select
                  id="company-category"
                  formControlName="category"
                  [options]="companyCategories"
                  optionLabel="label"
                  optionValue="value"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Vendor Name" for="company-vendor">
                <input pInputText id="company-vendor" formControlName="vendorName" class="w-full" />
              </ui-labeled-field>

              <ui-labeled-field label="Expense Date" for="company-date" [required]="true">
                <p-datepicker
                  id="company-date"
                  formControlName="expenseDate"
                  [showIcon]="true"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <ui-labeled-field label="Notes" for="company-notes">
              <textarea
                pInputTextarea
                id="company-notes"
                formControlName="notes"
                rows="3"
                class="w-full"
              ></textarea>
            </ui-labeled-field>

            <ui-labeled-field label="Receipt (Optional)">
              <p-fileUpload
                mode="basic"
                [auto]="true"
                accept="image/*,.pdf"
                chooseLabel="Upload Receipt"
                (onSelect)="onReceiptUpload($event)"
              />
              @if (receiptPath()) {
                <span class="mt-2 block text-sm text-green-600">
                  <i class="pi pi-check mr-1"></i>
                  Receipt attached
                </span>
              }
            </ui-labeled-field>

            <div class="flex justify-end gap-2 pt-4">
              <p-button label="Cancel" [routerLink]="['/expenses']" [outlined]="true" />
              <p-button
                type="submit"
                label="Create Expense"
                icon="pi pi-save"
                [loading]="isLoading()"
              />
            </div>
          </form>
        </p-tabpanel>

        <!-- Truck Expense Form -->
        <p-tabpanel [value]="1">
          <form [formGroup]="truckForm" (ngSubmit)="submitTruckExpense()" class="space-y-4 pt-4">
            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Amount" for="truck-amount" [required]="true">
                <p-inputNumber
                  id="truck-amount"
                  formControlName="amount"
                  mode="currency"
                  currency="USD"
                  [min]="0"
                  styleClass="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Category" for="truck-category" [required]="true">
                <p-select
                  id="truck-category"
                  formControlName="category"
                  [options]="truckCategories"
                  optionLabel="label"
                  optionValue="value"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Truck" for="truck-select" [required]="true">
                <p-select
                  id="truck-select"
                  formControlName="truckId"
                  [options]="trucks()"
                  optionLabel="number"
                  optionValue="id"
                  placeholder="Select a truck"
                  styleClass="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Expense Date" for="truck-date" [required]="true">
                <p-datepicker
                  id="truck-date"
                  formControlName="expenseDate"
                  [showIcon]="true"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Vendor Name" for="truck-vendor">
                <input pInputText id="truck-vendor" formControlName="vendorName" class="w-full" />
              </ui-labeled-field>

              <ui-labeled-field label="Odometer Reading" for="truck-odometer">
                <p-inputNumber
                  id="truck-odometer"
                  formControlName="odometerReading"
                  [min]="0"
                  suffix=" mi"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <ui-labeled-field label="Notes" for="truck-notes">
              <textarea
                pInputTextarea
                id="truck-notes"
                formControlName="notes"
                rows="3"
                class="w-full"
              ></textarea>
            </ui-labeled-field>

            <ui-labeled-field label="Receipt (Optional)">
              <p-fileUpload
                mode="basic"
                [auto]="true"
                accept="image/*,.pdf"
                chooseLabel="Upload Receipt"
                (onSelect)="onReceiptUpload($event)"
              />
              @if (receiptPath()) {
                <span class="mt-2 block text-sm text-green-600">
                  <i class="pi pi-check mr-1"></i>
                  Receipt attached
                </span>
              }
            </ui-labeled-field>

            <div class="flex justify-end gap-2 pt-4">
              <p-button label="Cancel" [routerLink]="['/expenses']" [outlined]="true" />
              <p-button
                type="submit"
                label="Create Expense"
                icon="pi pi-save"
                [loading]="isLoading()"
              />
            </div>
          </form>
        </p-tabpanel>

        <!-- Body Shop Expense Form -->
        <p-tabpanel [value]="2">
          <form
            [formGroup]="bodyShopForm"
            (ngSubmit)="submitBodyShopExpense()"
            class="space-y-4 pt-4"
          >
            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Amount" for="bodyshop-amount" [required]="true">
                <p-inputNumber
                  id="bodyshop-amount"
                  formControlName="amount"
                  mode="currency"
                  currency="USD"
                  [min]="0"
                  styleClass="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Truck" for="bodyshop-truck" [required]="true">
                <p-select
                  id="bodyshop-truck"
                  formControlName="truckId"
                  [options]="trucks()"
                  optionLabel="number"
                  optionValue="id"
                  placeholder="Select a truck"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Body Shop Name" for="bodyshop-vendor">
                <input
                  pInputText
                  id="bodyshop-vendor"
                  formControlName="vendorName"
                  class="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Expense Date" for="bodyshop-date" [required]="true">
                <p-datepicker
                  id="bodyshop-date"
                  formControlName="expenseDate"
                  [showIcon]="true"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Shop Address" for="bodyshop-address">
                <input
                  pInputText
                  id="bodyshop-address"
                  formControlName="vendorAddress"
                  class="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Shop Phone" for="bodyshop-phone">
                <input
                  pInputText
                  id="bodyshop-phone"
                  formControlName="vendorPhone"
                  class="w-full"
                />
              </ui-labeled-field>
            </div>

            <ui-labeled-field label="Repair Description" for="bodyshop-description">
              <textarea
                pInputTextarea
                id="bodyshop-description"
                formControlName="repairDescription"
                rows="3"
                class="w-full"
              ></textarea>
            </ui-labeled-field>

            <div class="grid grid-cols-2 gap-4">
              <ui-labeled-field label="Estimated Completion" for="bodyshop-est-date">
                <p-datepicker
                  id="bodyshop-est-date"
                  formControlName="estimatedCompletionDate"
                  [showIcon]="true"
                  styleClass="w-full"
                />
              </ui-labeled-field>

              <ui-labeled-field label="Actual Completion" for="bodyshop-actual-date">
                <p-datepicker
                  id="bodyshop-actual-date"
                  formControlName="actualCompletionDate"
                  [showIcon]="true"
                  styleClass="w-full"
                />
              </ui-labeled-field>
            </div>

            <ui-labeled-field label="Notes" for="bodyshop-notes">
              <textarea
                pInputTextarea
                id="bodyshop-notes"
                formControlName="notes"
                rows="3"
                class="w-full"
              ></textarea>
            </ui-labeled-field>

            <ui-labeled-field label="Receipt (Optional)">
              <p-fileUpload
                mode="basic"
                [auto]="true"
                accept="image/*,.pdf"
                chooseLabel="Upload Receipt"
                (onSelect)="onReceiptUpload($event)"
              />
              @if (receiptPath()) {
                <span class="mt-2 block text-sm text-green-600">
                  <i class="pi pi-check mr-1"></i>
                  Receipt attached
                </span>
              }
            </ui-labeled-field>

            <div class="flex justify-end gap-2 pt-4">
              <p-button label="Cancel" [routerLink]="['/expenses']" [outlined]="true" />
              <p-button
                type="submit"
                label="Create Expense"
                icon="pi pi-save"
                [loading]="isLoading()"
              />
            </div>
          </form>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </p-card>
</div>
