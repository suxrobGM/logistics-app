<div class="w-full p-6">
  <!-- Header -->
  <ui-page-header
    title="Load Board"
    subtitle="Search available loads, post trucks, and manage load board integrations"
  >
    <div class="flex gap-2">
      <p-button
        label="Search Loads"
        icon="pi pi-search"
        (onClick)="searchLoads()"
      />
      <p-button
        label="Post Truck"
        icon="pi pi-truck"
        severity="secondary"
        (onClick)="managePostedTrucks()"
      />
    </div>
  </ui-page-header>

  @if (loading()) {
    <div class="flex justify-center p-10">
      <p-progressSpinner />
    </div>
  } @else if (error()) {
    <div class="p-4 text-center">
      <i class="pi pi-exclamation-circle mb-3 text-4xl text-red-500"></i>
      <p class="text-red-500">{{ error() }}</p>
      <p-button label="Retry" icon="pi pi-refresh" (onClick)="loadDashboardData()" />
    </div>
  } @else {
    <!-- Stats Cards -->
    <div class="mb-6 grid grid-cols-1 gap-4 md:grid-cols-4">
      <ui-stat-card
        label="Active Providers"
        [value]="activeProviders().length"
        icon="pi-link"
        color="blue"
      />
      <ui-stat-card
        label="Available Loads"
        [value]="availableLoads()"
        icon="pi-box"
        color="green"
      />
      <ui-stat-card
        label="Posted Trucks"
        [value]="activePostedTrucks()"
        icon="pi-truck"
        color="purple"
      />
      <ui-stat-card
        label="Total Providers"
        [value]="providers().length"
        icon="pi-cog"
        color="orange"
      />
    </div>

    <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
      <!-- Configured Providers -->
      <ui-dashboard-card
        title="Configured Providers"
        icon="pi-link"
      >
        @if (providers().length === 0) {
          <div class="p-5 text-center">
            <i class="pi pi-link mb-3 text-4xl text-gray-400"></i>
            <p class="text-gray-600">No load board providers configured yet.</p>
            <p-button
              label="Add Provider"
              icon="pi pi-plus"
              (onClick)="configureProviders()"
              class="mt-3"
            />
          </div>
        } @else {
          <p-table [value]="providers()" [scrollable]="true" scrollHeight="250px">
            <ng-template pTemplate="header">
              <tr>
                <th>Provider</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-provider>
              <tr>
                <td>
                  <div class="flex items-center gap-2">
                    <i class="pi pi-link text-blue-600"></i>
                    <span class="font-medium">{{ provider.providerName || provider.providerType }}</span>
                  </div>
                </td>
                <td>
                  <p-tag
                    [value]="provider.isActive ? 'Active' : 'Inactive'"
                    [severity]="getProviderStatusSeverity(provider.isActive)"
                  />
                </td>
                <td>
                  <p-button
                    icon="pi pi-cog"
                    [rounded]="true"
                    [text]="true"
                    pTooltip="Configure"
                    (onClick)="configureProviders()"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        }
      </ui-dashboard-card>

      <!-- Posted Trucks -->
      <ui-dashboard-card
        title="Your Posted Trucks"
        icon="pi-truck"
      >
        @if (postedTrucks().length === 0) {
          <div class="p-5 text-center">
            <i class="pi pi-truck mb-3 text-4xl text-gray-400"></i>
            <p class="text-gray-600">No trucks posted to load boards yet.</p>
            <p-button
              label="Post a Truck"
              icon="pi pi-plus"
              (onClick)="managePostedTrucks()"
              class="mt-3"
            />
          </div>
        } @else {
          <p-table [value]="postedTrucks()" [scrollable]="true" scrollHeight="250px">
            <ng-template pTemplate="header">
              <tr>
                <th>Truck</th>
                <th>Provider</th>
                <th>Available From</th>
                <th>Status</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-truck>
              <tr>
                <td>
                  <span class="font-medium">{{ truck.truckNumber || "N/A" }}</span>
                </td>
                <td>{{ truck.providerName }}</td>
                <td>{{ truck.availableFrom | date: "shortDate" }}</td>
                <td>
                  <p-tag
                    [value]="truck.status"
                    [severity]="truck.status === 'available' ? 'success' : 'secondary'"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        }
      </ui-dashboard-card>
    </div>

    <!-- Quick Actions Card -->
    <div class="mt-6">
      <p-card class="border-0 shadow-sm">
        <ng-template pTemplate="header">
          <div class="flex items-center p-3">
            <i class="pi pi-bolt mr-2 text-yellow-600"></i>
            <h5 class="mb-0">Quick Actions</h5>
          </div>
        </ng-template>
        <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
          <div
            class="flex cursor-pointer items-center gap-3 rounded-lg border p-4 transition-colors hover:bg-gray-50"
            (click)="searchLoads()"
          >
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100">
              <i class="pi pi-search text-xl text-blue-600"></i>
            </div>
            <div>
              <h6 class="mb-1 font-medium">Search Loads</h6>
              <p class="mb-0 text-sm text-gray-500">Find available freight from load boards</p>
            </div>
          </div>

          <div
            class="flex cursor-pointer items-center gap-3 rounded-lg border p-4 transition-colors hover:bg-gray-50"
            (click)="managePostedTrucks()"
          >
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
              <i class="pi pi-truck text-xl text-green-600"></i>
            </div>
            <div>
              <h6 class="mb-1 font-medium">Post a Truck</h6>
              <p class="mb-0 text-sm text-gray-500">Advertise your available trucks</p>
            </div>
          </div>

          <div
            class="flex cursor-pointer items-center gap-3 rounded-lg border p-4 transition-colors hover:bg-gray-50"
            (click)="configureProviders()"
          >
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-purple-100">
              <i class="pi pi-cog text-xl text-purple-600"></i>
            </div>
            <div>
              <h6 class="mb-1 font-medium">Configure Providers</h6>
              <p class="mb-0 text-sm text-gray-500">Connect to DAT, Truckstop, 123Loadboard</p>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  }
</div>
