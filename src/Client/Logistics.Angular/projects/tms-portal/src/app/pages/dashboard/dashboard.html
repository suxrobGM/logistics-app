<div class="animate-fadein">
  <!-- Page Header -->
  <div class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="mb-1 text-2xl font-semibold">{{ greeting() }}</h1>
      <p class="text-muted">{{ currentDate | date: 'EEEE, MMMM d, yyyy' }}</p>
    </div>
    <div class="flex items-center gap-3">
      <!-- Data Freshness Indicator -->
      <div class="flex items-center gap-2 text-sm text-muted">
        <span>Updated {{ lastUpdated() | date: 'shortTime' }}</span>
        <p-button
          icon="pi pi-refresh"
          [rounded]="true"
          [text]="true"
          severity="secondary"
          (click)="refreshData()"
          pTooltip="Refresh data"
          tooltipPosition="bottom"
        />
      </div>
      <p-button
        label="Quick Actions"
        icon="pi pi-plus"
        [outlined]="true"
        (click)="menu.toggle($event)"
      />
      <p-menu #menu [model]="quickActions" [popup]="true" />
    </div>
  </div>

  <!-- KPI Cards Row -->
  <div class="mb-6 grid grid-cols-12 gap-4 animate-stagger">
    <ui-stat-card
      class="col-span-12 sm:col-span-6 lg:col-span-3"
      icon="pi-box"
      label="Active Loads"
      [value]="companyStats()?.activeLoadsCount ?? 0"
      color="blue"
    />
    <ui-stat-card
      class="col-span-12 sm:col-span-6 lg:col-span-3"
      icon="pi-truck"
      label="Fleet Size"
      [value]="companyStats()?.trucksCount ?? 0"
      color="green"
    />
    <ui-stat-card
      class="col-span-12 sm:col-span-6 lg:col-span-3"
      icon="pi-dollar"
      label="This Week Gross"
      [value]="(companyStats()?.thisWeekGross ?? 0 | currency) ?? '$0'"
      color="green"
      [trend]="thisWeekGrossTrend()?.value ?? null"
      [trendDirection]="thisWeekGrossTrend()?.direction ?? null"
    />
    <ui-stat-card
      class="col-span-12 sm:col-span-6 lg:col-span-3"
      icon="pi-chart-line"
      label="Rate Per Mile"
      [value]="(thisWeekRpm() | currency) ?? '$0'"
      color="purple"
      [trend]="rpmTrend()?.value ?? null"
      [trendDirection]="rpmTrend()?.direction ?? null"
    />
  </div>

  <!-- Widgets Row 1: Alerts & Financial -->
  <div class="mb-6 grid grid-cols-12 gap-4">
    <app-attention-panel
      class="col-span-12 lg:col-span-4"
      [unassignedLoadsCount]="companyStats()?.unassignedLoadsCount ?? 0"
      [idleTrucksCount]="companyStats()?.idleTrucksCount ?? 0"
      [isLoading]="isLoading()"
    />
    <app-financial-health-widget
      class="col-span-12 lg:col-span-4"
      [outstandingInvoiceTotal]="companyStats()?.outstandingInvoiceTotal ?? 0"
      [paymentsReceivedThisWeek]="companyStats()?.paymentsReceivedThisWeek ?? 0"
      [overdueInvoiceCount]="companyStats()?.overdueInvoiceCount ?? 0"
      [isLoading]="isLoading()"
    />
    <app-top-performers-widget
      class="col-span-12 lg:col-span-4"
      [topTrucks]="companyStats()?.topTrucks ?? []"
      [isLoading]="isLoading()"
    />
  </div>

  <!-- Widgets Row 2: Revenue & Team -->
  <div class="mb-6 grid grid-cols-12 gap-4">
    <app-gross-summary-widget
      class="col-span-12 lg:col-span-6"
      [thisWeekGross]="companyStats()?.thisWeekGross ?? 0"
      [lastWeekGross]="companyStats()?.lastWeekGross ?? 0"
      [thisMonthGross]="companyStats()?.thisMonthGross ?? 0"
      [lastMonthGross]="companyStats()?.lastMonthGross ?? 0"
      [lastThreeMonthsGross]="companyStats()?.lastThreeMonthsGross ?? 0"
      [lastYearGross]="companyStats()?.lastYearGross ?? 0"
      [totalGross]="companyStats()?.totalGross ?? 0"
      [isLoading]="isLoading()"
    />
    <app-team-overview-widget
      class="col-span-12 lg:col-span-6"
      [employeesCount]="companyStats()?.employeesCount ?? 0"
      [driversCount]="companyStats()?.driversCount ?? 0"
      [dispatchersCount]="companyStats()?.dispatchersCount ?? 0"
      [managersCount]="companyStats()?.managersCount ?? 0"
      [trucksCount]="companyStats()?.trucksCount ?? 0"
      [idleTrucksCount]="companyStats()?.idleTrucksCount ?? 0"
      [isLoading]="isLoading()"
    />
  </div>

  <!-- Map -->
  <div class="mb-6 grid grid-cols-12 gap-4">
    <app-trucks-map class="col-span-12" height="500px" />
  </div>

  <!-- Monthly Grosses Chart -->
  <div class="grid grid-cols-12 gap-4">
    <app-gross-barchart class="col-span-12" chartColor="#06b6d4" />
  </div>
</div>
