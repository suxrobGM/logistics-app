<h1 class="text-center">{{ title() }}</h1>

<div class="flex justify-center">
  <div class="w-full md:w-1/2">
    <p-card>
      @if (isLoading()) {
        <p-progress-spinner />
      }

      <form [formGroup]="form" (ngSubmit)="submit()">
        <shared-validation-summary [form]="form" />

        <div class="mb-4">
          <label for="dateRange" class="mb-2">Date range</label><br />
          <p-date-picker
            formControlName="dateRange"
            selectionMode="range"
            [showIcon]="true"
            [maxDate]="todayDate"
            (onSelect)="tryCalculatePayroll()"
          />
        </div>

        <div class="mb-4">
          <label for="employee" class="mb-2 block text-sm font-medium">Employee</label>
          <p-auto-complete formControlName="employee" class="w-full" inputStyleClass="w-full" />
        </div>

        <div class="mb-4">
          <label for="employee" class="mb-2 block text-sm font-medium">Employee</label>
          <p-auto-complete
            formControlName="employee"
            class="w-full"
            inputStyleClass="w-full"
            placeholder="Type employee's name"
            optionLabel="fullName"
            [minLength]="2"
            [suggestions]="suggestedEmployees()"
            (completeMethod)="searchEmployee($event)"
            (onSelect)="handleAutoCompleteSelectEvent($event)"
          />
        </div>

        @if (selectedEmployee() && previewPayrollInvoice()) {
          <h4>Preview Payroll Invoice</h4>
          <p-divider />

          <p>
            <strong>Employee Role:</strong>
            {{ selectedEmployee()!.role?.displayName ?? "N/A" }}
          </p>
          <p>
            <strong>Employee's Salary Type:</strong>
            {{ getSalaryTypeDesc(selectedEmployee()!.salaryType) }}
          </p>
          <p>
            <strong>Employee's Salary:</strong>
            @if (selectedEmployee()!.salaryType === "share_of_gross") {
              {{ selectedEmployee()!.salary | percent }}
            } @else {
              {{ selectedEmployee()!.salary | currency }}
            }
          </p>
          <p>
            <strong>Expected Invoice Total:</strong>
            {{ previewPayrollInvoice()!.total?.amount | currency }}
          </p>
        }

        <!-- @if (id()) {
          <div class="mb-3">
            <label for="paymentStatus" class="form-label">Payment Status</label>
            <p-select
              formControlName="paymentStatus"
              styleClass="w-full"
              [options]="paymentStatusOptions"
            >
            </p-select>
          </div>

          @if (form.get("paymentStatus")?.value === "paid") {
            <h4>Payment details</h4>
            <p-divider />

            <div class="mb-3">
              <label for="paymentMethod" class="form-label">Payment Method</label>
              <p-select
                formControlName="paymentMethod"
                styleClass="w-full"
                [options]="paymentMethodOptions"
              >
              </p-select>
            </div>

            <h5>Billing address</h5>
            <shared-address-form formControlName="paymentBillingAddress"></shared-address-form>
          }
        } -->

        <div class="flex gap-2">
          <p-button
            type="submit"
            class="mt-4"
            icon="pi pi-pencil"
            label="Save"
            [disabled]="isLoading || !form.valid || previewPayrollInvoice()?.total?.amount === 0"
          />
          <p-button
            type="button"
            class="mt-4 ml-2"
            icon="pi pi-arrow-left"
            label="Back to list"
            [routerLink]="['/invoices/payroll']"
          />
        </div>
      </form>
    </p-card>
  </div>
</div>
