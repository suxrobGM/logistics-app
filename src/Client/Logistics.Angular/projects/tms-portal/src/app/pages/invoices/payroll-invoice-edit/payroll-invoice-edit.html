<h1 class="text-center">{{ title() }}</h1>

<div class="flex justify-center">
  <div class="w-full md:w-1/2">
    <p-card>
      @if (isLoading()) {
        <p-progress-spinner />
      }

      <form [formGroup]="form" (ngSubmit)="submit()">
        <ui-validation-summary [form]="form" />

        <div class="mb-4">
          <label for="dateRange" class="mb-2">Date range</label><br />
          <p-date-picker
            formControlName="dateRange"
            selectionMode="range"
            [showIcon]="true"
            [maxDate]="todayDate"
            (onSelect)="tryCalculatePayroll()"
          />
        </div>

        <div class="mb-4">
          <label for="employee" class="mb-2 block text-sm font-medium">Employee</label>
          <p-autocomplete
            formControlName="employee"
            class="w-full"
            inputStyleClass="w-full"
            placeholder="Type employee's name"
            optionLabel="fullName"
            [minLength]="2"
            [suggestions]="suggestedEmployees()"
            (completeMethod)="searchEmployee($event)"
            (onSelect)="handleAutoCompleteSelectEvent($event)"
          />
        </div>

        @if (selectedEmployee() && previewPayrollInvoice()) {
          <h4>Preview Payroll Invoice</h4>
          <p-divider />

          <p>
            <strong>Employee Role:</strong>
            {{ selectedEmployee()!.role?.displayName ?? "N/A" }}
          </p>
          <p>
            <strong>Employee's Salary Type:</strong>
            {{ getSalaryTypeDesc(selectedEmployee()!.salaryType) }}
          </p>
          <p>
            <strong>Employee's Salary:</strong>
            @if (selectedEmployee()!.salaryType === "share_of_gross") {
              {{ selectedEmployee()!.salary | percent }}
            } @else {
              {{ selectedEmployee()!.salary | currency }}
            }
          </p>
          <p>
            <strong>Expected Invoice Total:</strong>
            {{ previewPayrollInvoice()!.total?.amount | currency }}
          </p>
        }

        <div class="flex gap-2">
          <p-button
            type="submit"
            class="mt-4"
            icon="pi pi-pencil"
            label="Save"
            [disabled]="isLoading || !form.valid || previewPayrollInvoice()?.total?.amount === 0"
          />
          <p-button
            type="button"
            class="mt-4 ml-2"
            icon="pi pi-arrow-left"
            label="Back to list"
            [routerLink]="['/invoices/payroll']"
          />
        </div>
      </form>
    </p-card>
  </div>
</div>
