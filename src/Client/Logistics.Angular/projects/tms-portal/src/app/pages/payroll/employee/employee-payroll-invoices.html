<div class="flex items-center">
  <h1 class="mb-0">Employee Payroll Invoices</h1>
  <p-button
    styleClass="text-black ml-2"
    icon="pi pi-plus-circle"
    size="large"
    [rounded]="true"
    [text]="true"
    pTooltip="Add a new payroll invoice"
    [routerLink]="['/payroll/invoices/add']"
  />
</div>

@if (isLoadingEmployee() || !employee()) {
  <div class="flex items-center">
    <p-progress-spinner />
    <div class="ml-2">Loading employee data</div>
  </div>
} @else {
  <p-card class="mb-4">
    <ng-template #header>
      <h4 class="py-2 pl-4">Payroll details</h4>
      <p-divider />
    </ng-template>

    <div class="grid grid-cols-12">
      <div class="col-span-12 md:col-span-5">
        <div class="mb-4 grid grid-cols-12">
          <div class="col-span-4">
            <h6>Employee:</h6>
          </div>
          <div class="col-span-8">
            {{ employee()!.fullName }}
          </div>
        </div>
        <div class="mb-4 grid grid-cols-12">
          <div class="col-span-4">
            <h6>Position:</h6>
          </div>
          <div class="col-span-8">
            {{ employee()!.role?.displayName ?? "N/A" }}
          </div>
        </div>
        <div class="mb-4 grid grid-cols-12">
          <div class="col-span-4">
            <h6>Salary type:</h6>
          </div>
          <div class="col-span-8">
            {{ getSalaryTypeDesc(employee()!.salaryType) }}
          </div>
        </div>
        <div class="mb-4 grid grid-cols-12">
          <div class="col-span-4">
            <h6>Salary:</h6>
          </div>
          <div class="col-span-8">
            @if (employee()!.salaryType === "share_of_gross") {
              {{ employee()!.salary | percent }}
            } @else {
              {{ employee()!.salary | currency }}
            }
          </div>
        </div>
      </div>
    </div>
  </p-card>
}

<p-card>
  <ui-data-container
    [loading]="store.isLoading()"
    [error]="store.error()"
    [isEmpty]="store.isEmpty()"
    skeletonVariant="table"
    [skeletonRows]="10"
    emptyTitle="No payroll invoices yet"
    emptyMessage="Create your first payroll invoice for this employee."
    emptyActionLabel="Add Invoice"
    (retry)="store.retry()"
    (emptyAction)="addInvoice()"
  >
    <p-table
      [value]="store.data()"
      [lazy]="true"
      [paginator]="true"
      [showCurrentPageReport]="true"
      (onLazyLoad)="store.onLazyLoad($event)"
      [rows]="store.pageSize()"
      [first]="store.first()"
      [totalRecords]="store.totalRecords()"
      [loading]="store.isLoading()"
      [rowsPerPageOptions]="[10, 25, 50]"
    >
      <ng-template #header>
        <tr>
          <th>Period</th>
          <th pSortableColumn="PaymentAmount">
            Invoice Amount
            <p-sortIcon field="PaymentAmount" />
          </th>
          <th pSortableColumn="PaymentStatus">
            Invoice Status
            <p-sortIcon field="PaymentStatus" />
          </th>
          <th>Action</th>
        </tr>
      </ng-template>

      <ng-template #body let-invoice>
        <tr>
          <td>
            {{ invoice.periodStart | date: "MMM d" }} - {{ invoice.periodEnd | date: "mediumDate" }}
          </td>
          <td>{{ invoice.total?.amount | currency }}</td>
          <td>
            @if (invoice.status) {
              <app-invoice-status-tag [status]="invoice.status" />
            } @else {
              <span class="text-muted-color">-</span>
            }
          </td>
          <td class="overflow-visible">
            <p-button
              class="ml-2"
              icon="pi pi-pen-to-square"
              pTooltip="Edit payroll"
              tooltipPosition="bottom"
              [routerLink]="['/payroll/invoices', invoice.id, 'edit']"
            />
            <p-button
              class="ml-2"
              icon="pi pi-eye"
              pTooltip="View payroll"
              tooltipPosition="bottom"
              [routerLink]="['/payroll/invoices', invoice.id]"
              [outlined]="true"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ui-data-container>
</p-card>
