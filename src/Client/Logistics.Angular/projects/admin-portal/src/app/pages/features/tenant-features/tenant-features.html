<ui-page-header [title]="'Feature Configuration: ' + (tenant()?.companyName ?? 'Loading...')" [showAddButton]="false">
  <div class="flex gap-2">
    <p-button icon="pi pi-arrow-left" label="Back" severity="secondary" (onClick)="goBack()" />
    <p-button
      icon="pi pi-save"
      label="Save Changes"
      [loading]="isSaving()"
      (onClick)="saveAll()"
    />
  </div>
</ui-page-header>

<p-card>
  @if (isLoading()) {
    <div class="flex justify-center py-8">
      <p-progress-spinner />
    </div>
  } @else {
    <p class="mb-4 text-muted">
      Configure feature settings for this tenant. Locked features cannot be changed by the
      tenant owner.
    </p>

    <p-table [value]="features()" [tableStyle]="{ 'min-width': '60rem' }">
      <ng-template #header>
        <tr>
          <th>Feature</th>
          <th>Description</th>
          <th class="text-center" style="width: 120px">Enabled</th>
          <th class="text-center" style="width: 120px">
            <span
              pTooltip="When locked, the tenant owner cannot change this setting"
              tooltipPosition="top"
            >
              Admin Locked
              <i class="pi pi-info-circle ml-1 text-xs"></i>
            </span>
          </th>
        </tr>
      </ng-template>
      <ng-template #body let-feature>
        <tr>
          <td class="font-medium">{{ feature.name }}</td>
          <td class="text-muted">{{ getFeatureDescription(feature.feature) }}</td>
          <td class="text-center">
            <p-toggleswitch
              [ngModel]="feature.isEnabled"
              (onChange)="toggleEnabled(feature)"
            />
          </td>
          <td class="text-center">
            <p-checkbox
              [ngModel]="feature.isAdminLocked"
              [binary]="true"
              (onChange)="toggleLocked(feature)"
            />
          </td>
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="4" class="text-center text-muted">No features available</td>
        </tr>
      </ng-template>
    </p-table>
  }
</p-card>
