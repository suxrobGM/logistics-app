<ui-page-header
  title="Subscription Plans"
  addRoute="/subscription-plans/add"
  addTooltip="Add a new subscription plan"
/>

<p-card>
  <ui-data-container
    [loading]="store.isLoading()"
    [error]="store.error()"
    [isEmpty]="store.isEmpty()"
    skeletonVariant="table"
    [skeletonRows]="10"
    emptyTitle="No subscription plans yet"
    emptyMessage="Add your first subscription plan to get started."
    emptyActionLabel="Add Plan"
    (retry)="store.retry()"
    (emptyAction)="addPlan()"
  >
    <p-table
      [value]="store.data()"
      [lazy]="true"
      [paginator]="true"
      [showCurrentPageReport]="true"
      (onLazyLoad)="store.onLazyLoad($event)"
      [rows]="store.pageSize()"
      [first]="store.first()"
      [totalRecords]="store.totalRecords()"
      [loading]="store.isLoading()"
      [rowsPerPageOptions]="[10, 25, 50]"
    >
      <ng-template #caption>
        <ui-search-input (searchChange)="search($event)" />
      </ng-template>
      <ng-template #header>
        <tr>
          <th pSortableColumn="Name">
            Name
            <p-sortIcon field="Name" />
          </th>
          <th pSortableColumn="Price">
            Price
            <p-sortIcon field="Price" />
          </th>
          <th>Billing Interval</th>
          <th>Trial Period</th>
          <th class="text-center">Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-plan>
        <tr>
          <td>
            <div>
              <span class="font-medium">{{ plan.name }}</span>
              @if (plan.description) {
                <p class="mt-1 text-sm text-gray-500">{{ plan.description }}</p>
              }
            </div>
          </td>
          <td>{{ plan.price | currency }}</td>
          <td>{{ formatInterval(plan.interval, plan.intervalCount) | titlecase }}</td>
          <td>{{ formatTrialPeriod(plan.trialPeriod) }}</td>
          <td class="text-center">
            <p-button
              icon="pi pi-pen-to-square"
              pTooltip="Edit Plan"
              [routerLink]="['/subscription-plans', plan.id, 'edit']"
            />
            <p-button
              styleClass="ml-2 p-button-danger"
              icon="pi pi-trash"
              pTooltip="Delete Plan"
              (click)="confirmToDelete(plan.id)"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ui-data-container>
</p-card>
