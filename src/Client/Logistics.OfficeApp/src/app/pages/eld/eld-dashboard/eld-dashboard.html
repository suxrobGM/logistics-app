<div class="grid">
  <!-- Summary Cards -->
  <div class="col-12 md:col-4">
    <p-card>
      <div class="flex justify-content-between align-items-center">
        <div>
          <span class="block text-500 font-medium mb-2">Available Drivers</span>
          <div class="text-900 font-bold text-3xl">{{ availableDrivers().length }}</div>
        </div>
        <div class="flex align-items-center justify-content-center bg-green-100 border-round" style="width: 3rem; height: 3rem">
          <i class="pi pi-check-circle text-green-500 text-2xl"></i>
        </div>
      </div>
    </p-card>
  </div>

  <div class="col-12 md:col-4">
    <p-card>
      <div class="flex justify-content-between align-items-center">
        <div>
          <span class="block text-500 font-medium mb-2">Total Drivers</span>
          <div class="text-900 font-bold text-3xl">{{ drivers().length }}</div>
        </div>
        <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width: 3rem; height: 3rem">
          <i class="pi pi-users text-blue-500 text-2xl"></i>
        </div>
      </div>
    </p-card>
  </div>

  <div class="col-12 md:col-4">
    <p-card>
      <div class="flex justify-content-between align-items-center">
        <div>
          <span class="block text-500 font-medium mb-2">HOS Violations</span>
          <div class="text-900 font-bold text-3xl" [class.text-red-500]="violationCount() > 0">{{ violationCount() }}</div>
        </div>
        <div class="flex align-items-center justify-content-center border-round" [class.bg-red-100]="violationCount() > 0" [class.bg-gray-100]="violationCount() === 0" style="width: 3rem; height: 3rem">
          <i class="pi pi-exclamation-triangle text-2xl" [class.text-red-500]="violationCount() > 0" [class.text-gray-500]="violationCount() === 0"></i>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Main Content -->
  <div class="col-12">
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center p-3">
          <h2 class="m-0">Driver Hours of Service</h2>
          <div class="flex gap-2">
            <p-button
              label="Configure Providers"
              icon="pi pi-cog"
              severity="secondary"
              (onClick)="configureProviders()"
            ></p-button>
            <p-button
              label="Sync HOS Data"
              icon="pi pi-refresh"
              [loading]="loading()"
              (onClick)="syncDriversHos()"
            ></p-button>
          </div>
        </div>
      </ng-template>

      @if (loading()) {
        <div class="flex justify-content-center p-5">
          <p-progressSpinner></p-progressSpinner>
        </div>
      } @else if (error()) {
        <div class="p-4 text-center">
          <i class="pi pi-exclamation-circle text-red-500 text-4xl mb-3"></i>
          <p class="text-red-500">{{ error() }}</p>
          <p-button label="Retry" icon="pi pi-refresh" (onClick)="loadDriversHos()"></p-button>
        </div>
      } @else if (drivers().length === 0) {
        <div class="p-5 text-center">
          <i class="pi pi-info-circle text-blue-500 text-4xl mb-3"></i>
          <p class="text-600">No driver HOS data available.</p>
          <p class="text-500 text-sm">Configure an ELD provider and map your drivers to start tracking HOS.</p>
          <p-button label="Configure Providers" icon="pi pi-cog" (onClick)="configureProviders()" class="mt-3"></p-button>
        </div>
      } @else {
        <p-table
          [value]="drivers()"
          [paginator]="true"
          [rows]="10"
          [rowsPerPageOptions]="[10, 25, 50]"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} drivers"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="employeeName">Driver <p-sortIcon field="employeeName"></p-sortIcon></th>
              <th pSortableColumn="currentDutyStatus">Status <p-sortIcon field="currentDutyStatus"></p-sortIcon></th>
              <th>Driving Time Left</th>
              <th>On-Duty Time Left</th>
              <th>Cycle Time Left</th>
              <th pSortableColumn="isAvailableForDispatch">Available <p-sortIcon field="isAvailableForDispatch"></p-sortIcon></th>
              <th pSortableColumn="lastUpdatedAt">Last Updated <p-sortIcon field="lastUpdatedAt"></p-sortIcon></th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-driver>
            <tr [class.bg-red-50]="driver.isInViolation">
              <td>
                <div class="flex align-items-center gap-2">
                  @if (driver.isInViolation) {
                    <i class="pi pi-exclamation-triangle text-red-500" pTooltip="HOS Violation"></i>
                  }
                  <span class="font-medium">{{ driver.employeeName }}</span>
                </div>
              </td>
              <td>
                <p-tag
                  [value]="driver.currentDutyStatusDisplay"
                  [severity]="getDutyStatusSeverity(driver.currentDutyStatus)"
                ></p-tag>
              </td>
              <td>
                <span [class.text-red-500]="driver.drivingMinutesRemaining < 60">
                  {{ driver.drivingTimeRemainingDisplay }}
                </span>
              </td>
              <td>
                <span [class.text-orange-500]="driver.onDutyMinutesRemaining < 120">
                  {{ driver.onDutyTimeRemainingDisplay }}
                </span>
              </td>
              <td>{{ driver.cycleTimeRemainingDisplay }}</td>
              <td>
                @if (driver.isAvailableForDispatch) {
                  <p-tag value="Available" severity="success"></p-tag>
                } @else {
                  <p-tag value="Unavailable" severity="danger"></p-tag>
                }
              </td>
              <td>{{ driver.lastUpdatedAt | date: 'short' }}</td>
              <td>
                <p-button
                  icon="pi pi-history"
                  [rounded]="true"
                  [text]="true"
                  pTooltip="View Logs"
                  (onClick)="viewDriverLogs(driver.employeeId)"
                ></p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      }
    </p-card>
  </div>
</div>
